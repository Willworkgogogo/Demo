/*jquery.smartbox.js v1.0.3 Author:https://github.com/huangshuwei/*/
!function(o,e,t,i){function s(e,t){var i=this;i.element=e,i.$element=o(e),i.defaults=l,i.options=o.extend({},this.defaults,t),i.ajaxOption=t?o.extend({},this.defaults.ajaxSetting,t.ajaxSetting):this.defaults.ajaxSetting,i.overlayZIndex=i.options.zIndex-1,i.$smartBoxOverlay=o('<div class="smartBoxOverlay '+i.overlayZIndex+'"></div>'),i.setValue(),i.version="v1.0.0"}function a(){var e=0;return o(".smartBox").each(function(){var t=parseInt(o(this).css("zIndex"),10);t>e&&(e=t)}),e}var n,r,l={type:"option",width:360,height:360,titleHeight:50,footerHeight:50,title:null,footer:null,titleBgColor:"#eee",footerBgColor:"#fff",borderColor:"#adabab",borderRadius:0,borderWidth:1,isShowTitle:!0,isShowFooter:!0,isAutoShow:!0,zIndex:9999,content:null,ajaxSetting:{url:null,contentType:"html",isShowLoading:!0,loadingType:"img",loadingText:"正在加载...",errorContent:""},isDrag:!0,dragType:"replace",isShowOverlay:!0,isCloseOnOverlayClick:!0,overlayOpacity:.3,isShowClose:!0,closeType:"in",beforeShow:o.noop,afterShow:o.noop,beforeRequest:o.noop,afterRequest:o.noop,beforeClose:o.noop,afterClose:o.noop},d=navigator.userAgent.match(/msie/i);s.prototype={tpl:{smartBox:["<div>",'<div class="smartBox_header">','<div class="smartBox_title"></div>',"</div>",'<div class="smartBox_body">',"</div>",'<div class="smartBox_footer">',"</div>","</div>"].join(""),loading:'<div class="smartBoxLoadingText"></div>',closeNormal:'<a class="smartBox_header_close_normal"></a>',closeCircle:'<a class="smartBox_header_close_circle"></a>',iframe:'<iframe class="smartBox_iframe" frameborder="0" vspace="0" hspace="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen'+(d?' allowtransparency="true"':"")+' width="100%" height="100%"></iframe>'},init:function(){console.log("smartbox init");var o=this;return o.createContainer(),o.setValue(),o.adjustBox(),o.options.isAutoShow&&o.open(),o.$element},createContainer:function(){var e,t,i,s=this,a=s.options.type.toLowerCase(),n=o(s.tpl.smartBox),r=n.find(".smartBox_header"),l=n.find(".smartBox_title"),d=o("in"===s.options.closeType.toLowerCase()?s.tpl.closeNormal:s.tpl.closeCircle),p=n.find(".smartBox_body"),c=n.find(".smartBox_footer"),m=s.options.borderRadius-s.options.borderWidth-1;s.options.isShowTitle?("option"===a?e=s.options.title?s.options.title:"":"inline"===a&&(e=s.$title&&s.$title.html()?s.$title.html():""),l.html(e),r.css({"background-color":s.options.titleBgColor,height:s.options.titleHeight+"px","line-height":s.options.titleHeight+"px"}).addClass("smartBox_header_border"),m>0&&r.css({"border-radius":""+m+"px "+m+"px 0 0","-moz-border-radius":""+m+"px "+m+"px 0 0","-webkit-border-radius":""+m+"px "+m+"px 0 0"})):l.remove(),s.options.isShowClose&&r.append(d),"option"===a?t=s.options.content?s.options.content:"":"inline"===a&&(t=s.$body&&s.$body.html()?s.$body.html():""),p.html(t),s.options.isShowFooter?(i="option"===a?s.options.footer:s.$footer&&s.$footer.html()?s.$footer.html():"",c.html(i).css({height:s.options.footerHeight+"px","line-height":s.options.footerHeight+"px","background-color":s.options.footerBgColor}),m>0&&c.css({"border-radius":"0 0 "+m+"px "+m+"px","-moz-border-radius":"0 0 "+m+"px "+m+"px","-webkit-border-radius":"0 0 "+m+"px "+m+"px"})):c.remove(),s.options.isShowOverlay&&(s.$smartBoxOverlay.css({"z-index":s.overlayZIndex,opacity:s.options.overlayOpacity,filter:"alpha(opacity="+100*s.options.overlayOpacity+")"}),o("body").append(s.$smartBoxOverlay)),s.$element.html(n.html()).css({display:"none","border-color":s.options.borderColor,"border-width":s.options.borderWidth+"px","border-radius":s.options.borderRadius,"-moz-border-radius":s.options.borderRadius,"-webkit-border-radius":s.options.borderRadius}).addClass("smartBox")},setValue:function(){var o=this;o.$header=o.$element.find(".smartBox_header"),o.$title=o.$element.find(".smartBox_title"),o.$close="in"===o.options.closeType?o.$element.find(".smartBox_header_close_normal"):o.$element.find(".smartBox_header_close_circle"),o.$body=o.$element.find(".smartBox_body"),o.$footer=o.$element.find(".smartBox_footer")},adjustBox:function(){var t,i=this;i.$element.css({width:i.options.width,height:i.options.height,"z-index":i.options.zIndex}),t=i.options.height-i.$header.outerHeight(),i.options.isShowFooter&&(t-=i.$footer.outerHeight()),i.$body.css({height:t}),i.options.isDrag?i.$element.css({top:Math.max(0,(o(e).height()-i.$element.outerHeight())/2)+"px",left:Math.max(0,(o(e).width()-i.$element.outerWidth())/2)+"px"}):i.$element.css({"margin-top":-(i.$element.outerHeight()/2),"margin-left":-(i.$element.outerWidth()/2)})},loadContent:function(){var o=this,e=o.ajaxOption.contentType.toLowerCase();o.$body.html(""),"html"===e?o.asyncLoadHtml():"img"===e?o.asyncLoadImage():"iframe"===e&&o.asyncLoadByIframe()},asyncLoadHtml:function(){var e=this;o.ajax({url:e.ajaxOption.url,dataType:"html",beforeSend:function(){e.beforeLoad()},success:function(o){e.$body.html(o),e.loadSuccess()},error:function(){e.loadError()},complete:function(){e.afterLoad()}})},asyncLoadImage:function(){var e=this,t=new Image;t.onload=function(){o(t).addClass("smartBox_body_img_center"),e.$body.html(t).addClass("smartBox_img_center"),e.loadSuccess(),e.afterLoad()},t.onerror=function(){e.loadError(),e.afterLoad()},t.src=e.ajaxOption.url,t.complete!==!0&&e.beforeLoad()},asyncLoadByIframe:function(){var e=this,t=o(e.tpl.iframe);e.beforeLoad(),t.attr("src",e.ajaxOption.url),t.one("load",function(){t.css("display",""),e.loadSuccess(),e.afterLoad()}),e.$body.append(t.css("display","none"))},beforeLoad:function(){var e=this;if(console.log("beforeRequest"),e.options.beforeRequest(),e.ajaxOption.isShowLoading)if("img"===e.ajaxOption.loadingType)e.$body.addClass("smartBoxLoadingImg");else{var t=o(e.tpl.loading).html(e.ajaxOption.loadingText);e.$body.html(t)}},loadError:function(){var e,t=this;t.ajaxOption.errorContent&&(e=o(t.tpl.loading).html(t.ajaxOption.errorContent),t.$body.html(e)),t.$body.removeClass("smartBoxLoadSuccess")},loadSuccess:function(){this.$body.addClass("smartBoxLoadSuccess")},afterLoad:function(){var o=this;console.log("afterRequest"),o.options.afterRequest(),o.ajaxOption.isShowLoading&&("img"===o.ajaxOption.loadingType?o.$body.removeClass("smartBoxLoadingImg"):"text"===o.ajaxOption.loadingType&&"iframe"===o.ajaxOption.contentType.toLowerCase()&&o.$body.find(".smartBoxLoadingText").remove())},isLoadSuccess:function(){return this.$body.hasClass("smartBoxLoadSuccess")},isOpened:function(){var o=this;return o.$element.is(":visible")},isClosed:function(){return!this.$element.is(":visible")},dragBox:function(){var e=this;e.$title.bind("mousedown",function(i){i.preventDefault(),e.allowDrag=!0;var s,a,n=e.$element.offset().left-o(t).scrollLeft(),r=e.$element.offset().top-o(t).scrollTop();"replace"===e.options.dragType.toLowerCase()&&(s=e.$element.outerWidth()-1,a=e.$element.outerHeight()-1,e.$drag=o('<div class="smartbox_drag" style="left:'+n+"px; top:"+r+"px; width:"+s+"px; height:"+a+'px; z-index:2147483647"></div>'),e.$drag.css({"border-radius":e.options.borderRadius,"-moz-border-radius":e.options.borderRadius,"-webkit-border-radius":e.options.borderRadius}),o("body").append(e.$drag)),e.moveX=i.pageX-n,e.moveY=i.pageY-r,n=r=s=a=null});var i=0;o(t).bind("mousemove",function(o){if(o.preventDefault(),e.allowDrag){var t=Date.now();if(t-i>15){i=t;var s=o.pageX-e.moveX,a=o.pageY-e.moveY;"replace"===e.options.dragType.toLowerCase()?e.$drag.css({left:s,top:a}):e.$element.css({left:s,top:a}),s=a=null}}}).bind("mouseup",function(){if(e.allowDrag&&"replace"===e.options.dragType.toLowerCase()){var o=e.$drag.position().left,t=e.$drag.position().top;e.$element.css({left:o,top:t}),e.$drag.remove()}e.allowDrag=!1})},open:function(){var o=this;o.isOpened()||(o.bindEvent(),!1!==o.options.beforeShow()&&(o.options.ajaxSetting.url&&!o.isLoadSuccess()&&o.loadContent(),o.options.isShowOverlay&&o.$smartBoxOverlay.show(),o.$element.show(),o.afterShow()))},close:function(){var o=this;o.isClosed()||!1!==o.options.beforeClose()&&(o.options.isShowOverlay&&o.$smartBoxOverlay.hide(),o.$element.hide(),o.unbindEvent(),o.afterClose())},afterShow:function(){var o=this;e.clearTimeout(n),n=e.setTimeout(o.options.afterShow,10)},afterClose:function(){var o=this;e.clearTimeout(r),r=e.setTimeout(o.options.afterClose,10)},bindEvent:function(){var e=this;e.options.isShowClose&&e.$close.bind("click",function(){e.close()}),e.options.isCloseOnOverlayClick&&e.options.isShowOverlay&&e.$smartBoxOverlay.bind("click",function(o){e.close()}),e.options.isShowOverlay||e.$element.bind("mousedown",function(){o(".smartBox:visible").length>1&&e.$element.css("z-index",a()+1)}),e.options.isDrag&&(e.$title.addClass("smartBox_title_move"),e.dragBox())},unbindEvent:function(){var e=this;e.$close.unbind("click"),e.$smartBoxOverlay.unbind("click"),e.options.isDrag&&e.$title.unbind("mousedown"),e.options.isShowOverlay||e.$element.unbind("mousedown"),o(".smartBox").is(":visible")||(o(t).unbind("mousemove"),o(t).unbind("mouseup"))}},o.fn.smartbox=function(e,t){var i="smartboxKey";return this.each(function(){var a=o(this),n=a.data(i);"string"==typeof e?n&&"function"==typeof n[e]?"close"!==e&&"open"!==e||n[e](t):n?console.error("method "+e+" does not exist on jquery.smartbox!"):console.error("you should instance jquery.smartbox before use it!"):(n=new s(this,e),n.init(),a.data(i,n))})}}(jQuery,window,document);